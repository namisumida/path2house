function init(){function getOrder(counts_data){for(var sorted_data=counts_data.sort(function(a,b){return b.count-a.count}),sorted_exp=[],i=0;i<sorted_data.length;i++)sorted_exp.push(sorted_data[i].experience);return sorted_exp}function updateDots(colGroup,dataset){for(var j=0;j<4;j++){var collegeDots=colGroup.selectAll("#"+toplineOrder_college[j]).data(dataset.filter(function(d){return 1==d[toplineOrder_college[j]]}));collegeDots.exit().remove();var collegeDotsEnter=collegeDots.enter().append("circle").attr("class","memberDots").attr("id",function(d){return toplineOrder_college[j]}).attr("r",circleRadius);(collegeDots=collegeDots.merge(collegeDotsEnter)).attr("cx",function(d,i){return circleSpace*Math.floor(i/circlesPerCol)}).attr("cy",function(d,i){return h_bigLabels+(10+circleSpace*circlesPerCol)*j+circleSpace*(i%circlesPerCol)})}for(j=0;j<4;j++){var gradDots=colGroup.selectAll("#"+toplineOrder_grad[j]).data(dataset.filter(function(d){return 1==d[toplineOrder_grad[j]]}));gradDots.exit().remove();var gradDotsEnter=gradDots.enter().append("circle").attr("class","memberDots").attr("id",function(d){return toplineOrder_grad[j]}).attr("r",circleRadius);(gradDots=gradDots.merge(gradDotsEnter)).attr("cx",function(d,i){return circleSpace*Math.floor(i/circlesPerCol)}).attr("cy",function(d,i){return 2*h_bigLabels+4*(circlesPerCol*circleSpace+10)+margin_btwn+(circlesPerCol*circleSpace+10)*j+circleSpace*(i%circlesPerCol)})}for(j=0;j<15;j++){var careerDots=colGroup.selectAll("#"+toplineOrder_career[j]).data(dataset.filter(function(d){return 1==d[toplineOrder_career[j]]}));careerDots.exit().remove();var careerDotsEnter=careerDots.enter().append("circle").attr("class","memberDots").attr("id",function(d){return toplineOrder_career[j]}).attr("r",circleRadius);(careerDots=careerDots.merge(careerDotsEnter)).attr("cx",function(d,i){return circleSpace*Math.floor(i/circlesPerCol)}).attr("cy",function(d,i){return 3*h_bigLabels+8*(circlesPerCol*circleSpace+10)+2*margin_btwn+(circlesPerCol*circleSpace+10)*j+circleSpace*(i%circlesPerCol)})}for(j=0;j<5;j++){var govDots=colGroup.selectAll("#"+toplineOrder_gov[j]).data(dataset.filter(function(d){return 1==d[toplineOrder_gov[j]]}));govDots.exit().remove();var govDotsEnter=govDots.enter().append("circle").attr("class","memberDots").attr("id",function(d){return toplineOrder_gov[j]}).attr("r",circleRadius);(govDots=govDots.merge(govDotsEnter)).attr("cx",function(d,i){return circleSpace*Math.floor(i/circlesPerCol)}).attr("cy",function(d,i){return 4*h_bigLabels+23*(circlesPerCol*circleSpace+10)+3*margin_btwn+(circlesPerCol*circleSpace+10)*j+circleSpace*(i%circlesPerCol)})}}function colorDots(){svg.selectAll(".memberDots").style("fill",function(d){return currExp&1==d[currValue]?experienceColor:currState&d.state==currValue?stateColor:green})}function changeButtonStyle(button){button.style("background-color",green).style("color","white").style("border","none"),"party"==button.attr("value")?defaultButtonStyle(d3.select("#button-year")):defaultButtonStyle(d3.select("#button-party"))}function defaultButtonStyle(button){button.style("background-color","white").style("color","black").style("border","1.5px solid")}function comparisonView(type){if("party"==type)var maxDots=119,dataset_col1=dataset_ind.filter(function(d){return"Democrat"==d.party}),dataset_col2=dataset_ind.filter(function(d){return"Republican"==d.party});else maxDots=164,dataset_col1=dataset_ind.filter(function(d){return 1==d.new}),dataset_col2=dataset_ind.filter(function(d){return 0==d.new});var columnWidth=(w-10-w_labels-margin_btwnCol-10)/2;circlesPerRowMax=Math.floor(columnWidth/circleSpace),circlesPerCol=Math.ceil(maxDots/circlesPerRowMax),circlesPerRow=Math.ceil(maxDots/circlesPerCol),margin_left=margin_right=(w-w_labels-circlesPerRow*circleSpace*2-margin_btwnCol)/2,h=margin_top+4*h_bigLabels+28*(circlesPerCol*circleSpace+10)+3*margin_btwn+margin_bottom,document.getElementById("chart-svg").style.height=h,svg.select("#labelGroup").attr("transform","translate("+margin_left+","+(margin_top+15)+")"),svg.select("#col1").attr("transform","translate("+(margin_left+w_labels)+","+(margin_top+15)+")"),updateDots(d3.select("#col1"),dataset_col1),svg.select("#labelGroup").attr("transform","translate("+margin_left+","+margin_top+")"),svg.append("text").attr("class","bigLabels").text("Democrats").attr("x",margin_left+w_labels+10*circleSpace).attr("y",margin_top).style("text-anchor","middle"),svg.select("#labelGroup").selectAll(".bigLabels").attr("x",0).attr("y",function(d,i){return 0==i?10:1==i?h_bigLabels+4*(circlesPerCol*circleSpace+10)+margin_btwn:2==i?2*h_bigLabels+8*(circlesPerCol*circleSpace+10)+2*margin_btwn:3==i?3*h_bigLabels+23*(circlesPerCol*circleSpace+10)+3*margin_btwn:void 0}),svg.select("#labelGroup").selectAll("#collegeSmallLabels").text(function(d){return d}).attr("x",0).attr("y",function(d,i){return h_bigLabels+circleSpace*(circlesPerCol/3)+(10+circleSpace*circlesPerCol)*i}).call(wrap,w_labels-20),svg.select("#labelGroup").selectAll("#gradSmallLabels").text(function(d){return d}).attr("x",0).attr("y",function(d,i){return 2*h_bigLabels+4*(circlesPerCol*circleSpace+10)+margin_btwn+circleSpace*(circlesPerCol/3)+(10+circleSpace*circlesPerCol)*i}).call(wrap,w_labels-20),svg.select("#labelGroup").selectAll("#careerSmallLabels").text(function(d){return d}).attr("x",0).attr("y",function(d,i){return 3*h_bigLabels+8*(circlesPerCol*circleSpace+10)+2*margin_btwn+circleSpace*(circlesPerCol/3)+(10+circleSpace*circlesPerCol)*i}).call(wrap,w_labels-20),svg.select("#labelGroup").selectAll(".govSmallLabels").text(function(d){return d}).attr("x",0).attr("y",function(d,i){return 4*h_bigLabels+23*(circlesPerCol*circleSpace+10)+3*margin_btwn+circleSpace*(circlesPerCol/3)+(10+circleSpace*circlesPerCol)*i}).call(wrap,w_labels-20),svg.select("#col2").attr("transform","translate("+(margin_left+w_labels+columnWidth+margin_btwnCol)+","+(margin_top+15)+")"),updateDots(d3.select("#col2"),dataset_col2),svg.append("text").attr("class","bigLabels").text("Republicans").attr("x",margin_left+w_labels+columnWidth+margin_btwnCol+circlesPerRow*circleSpace/2).attr("y",margin_top).style("text-anchor","middle")}function wrap(text,width){text.each(function(){for(var word,text=d3.select(this),words=text.text().split(/\s+/).reverse(),line=[],lineNumber=0,x=text.attr("x"),y=text.attr("y"),tspan=text.text(null).append("tspan").attr("x",x).attr("y",y).attr("dy","0em");word=words.pop();)line.push(word),tspan.text(line.join(" ")),tspan.node().getComputedTextLength()>width&&(line.pop(),tspan.text(line.join(" ")),line=[word],tspan=text.append("tspan").attr("x",x).attr("y",y).attr("dy",1.3*++lineNumber+0+"em").text(word))})}function autocomplete(inp,arr){function addActive(x){if(!x)return!1;!function(x){for(var i=0;i<x.length;i++)x[i].classList.remove("autocomplete-active")}(x),currentFocus>=x.length&&(currentFocus=0),currentFocus<0&&(currentFocus=x.length-1),x[currentFocus].classList.add("autocomplete-active"),x[currentFocus].style.color="black",x[currentFocus].style.backgroundColor=stateColor}function closeAllLists(elmnt){for(var x=document.getElementsByClassName("autocomplete-items"),i=0;i<x.length;i++)elmnt!=x[i]&&elmnt!=inp&&x[i].parentNode.removeChild(x[i])}var currentFocus;inp.addEventListener("input",function(e){var a,b,i,val=this.value;if(closeAllLists(),!val)return!1;for(currentFocus=-1,(a=document.createElement("DIV")).setAttribute("id",this.id+"autocomplete-list"),a.style.width=d3.select(".searchbar-input").style("width"),a.setAttribute("class","autocomplete-items"),this.parentNode.appendChild(a),i=0;i<arr.length;i++)arr[i].substr(0,val.length).toUpperCase()==val.toUpperCase()&&((b=document.createElement("DIV")).innerHTML="<strong>"+arr[i].substr(0,val.length)+"</strong>",b.innerHTML+=arr[i].substr(val.length),b.innerHTML+='<input type="hidden" value="'+arr[i]+'">',b.addEventListener("click",function(e){inp.value=this.getElementsByTagName("input")[0].value,closeAllLists(),arr==statesList?searchState(inp.value):searchRep(inp.value),inp.value=""}),a.appendChild(b))}),inp.addEventListener("keydown",function(e){var x=document.getElementById(this.id+"autocomplete-list");x&&(x=x.getElementsByTagName("div")),40==e.keyCode?(old=currentFocus,currentFocus++,addActive(x),-1<old&&(x[old].style.backgroundColor=d3.color("#fff"))):38==e.keyCode?(old=currentFocus,currentFocus--,addActive(x),-1<old&&(x[old].style.backgroundColor=d3.color("#fff"))):13==e.keyCode&&(e.preventDefault(),-1<currentFocus&&x&&x[currentFocus].click())}),document.addEventListener("click",function(e){closeAllLists(e.target)})}function searchState(state){svg.selectAll(".smallLabels").style("fill","black").style("font-weight",400),currValue=statesAbbrevList[statesList.indexOf(state)],currExp=!(currState=!0),updateDots(d3.select("#col1"),dataset_ind.sort(function(a,b){return(b.state==currValue)-(a.state==currValue)})),colorDots()}function searchRep(rep){svg.selectAll(".smallLabels").style("fill","black").style("font-weight",400),svg.selectAll(".memberDots").style("fill",function(d){return currExp&1==d[currValue]?experienceColor:currState&d.state==currValue?stateColor:green}),currRep=rep,svg.selectAll(".memberDots").filter(function(d){return d.full_name==rep}).style("fill",repColor)}var svg=d3.select("#chart-svg"),w=document.getElementById("chart-svg").getBoundingClientRect().width,margin_top=margin_bottom=margin_btwn=20,margin_btwnCol=15,w_labels=105,circleRadius=5,circleSpace=12,circlesPerRowMax=Math.floor((w-w_labels-20)/circleSpace),circlesPerCol=Math.ceil(219/circlesPerRowMax),circlesPerRow=Math.ceil(219/circlesPerCol),h_bigLabels=20,margin_left=margin_right=(w-w_labels-circlesPerRow*circleSpace)/2,h=margin_top+4*h_bigLabels+28*(circlesPerCol*circleSpace+10)+3*margin_btwn+margin_bottom;document.getElementById("chart-svg").style.height=h;var currExp,currState,currRep,currValue,green=d3.color("#377668"),experienceColor=d3.color("#A45A25"),repColor=d3.color("#D1A730"),stateColor=d3.color("#743D47"),toplineOrder_college=getOrder(dataset_counts.slice(0,4)),toplineOrder_grad=getOrder(dataset_counts.slice(4,8)),toplineOrder_career=getOrder(dataset_counts.slice(8,23)),toplineOrder_gov=getOrder(dataset_counts.slice(23,28)),statesList=["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","District of Columbia","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"],statesAbbrevList=["AL","AK","AZ","AR","CA","CO","CT","DL","DC","FL","GA","HI","ID","IL","IN","IA","KS","KT","LA","MA","MD","MA","MI","MN","MS","MO","MN","NE","NV","NH","NJ","NM","NY","NC","ND","OH","OK","OR","PA","RH","SC","SD","TN","TX","UT","VT","VA","WA","WV","WI","WY"];autocomplete(document.getElementById("searchbar-state"),statesList);for(var repsList=[],i=0;i<dataset_ind.length;i++)repsList.push(dataset_ind[i].full_name);autocomplete(document.getElementById("searchbar-rep"),repsList),d3.select("#button-party").on("click",function(){changeButtonStyle(d3.select(this)),d3.select("#button-total").style("display","inline"),comparisonView("party")}),d3.select("#button-year").on("click",function(){var currButton=d3.select(this);changeButtonStyle(currButton),d3.select("#button-total").style("display","inline"),comparisonView(currButton.value)}),d3.select("#button-total").on("click",function(){d3.select(this).style("display","none"),defaultButtonStyle(d3.selectAll("button"))}),currValue="",function(){svg.append("g").attr("id","labelGroup").attr("transform","translate("+margin_left+","+margin_top+")"),svg.append("g").attr("id","col1").attr("transform","translate("+(margin_left+w_labels)+","+margin_top+")"),svg.append("g").attr("id","col2"),svg.select("#labelGroup").selectAll(".gBigLabels").data(["COLLEGE","GRADUATE SCHOOL","CAREER","POLITICAL OFFICE"]).enter().append("text").attr("class","bigLabels").attr("x",0).attr("y",function(d,i){return 0==i?10:1==i?h_bigLabels+4*(circlesPerCol*circleSpace+10)+margin_btwn:2==i?2*h_bigLabels+8*(circlesPerCol*circleSpace+10)+2*margin_btwn:3==i?3*h_bigLabels+23*(circlesPerCol*circleSpace+10)+3*margin_btwn:void 0}).text(function(d){return d});for(var j=0;j<4;j++)svg.select("#col1").selectAll("collegeDots").data(dataset_ind.filter(function(d){return 1==d[toplineOrder_college[j]]})).enter().append("circle").attr("class","memberDots").attr("id",function(d){return toplineOrder_college[j]}).attr("cx",function(d,i){return circleSpace*Math.floor(i/circlesPerCol)}).attr("cy",function(d,i){return h_bigLabels+(10+circleSpace*circlesPerCol)*j+circleSpace*(i%circlesPerCol)}).attr("r",circleRadius);for(svg.select("#labelGroup").selectAll("labels").data(["Public school","Private school","Elite school","No Bachelor's degree"]).enter().append("text").attr("class","smallLabels").attr("id","collegeSmallLabels").text(function(d){return d}).attr("x",0).attr("y",function(d,i){return h_bigLabels+circleSpace*(circlesPerCol/3)+(10+circleSpace*circlesPerCol)*i}).call(wrap,w_labels-20),j=0;j<4;j++)svg.select("#col1").selectAll("gradDots").data(dataset_ind.filter(function(d){return 1==d[toplineOrder_grad[j]]})).enter().append("circle").attr("class","memberDots").attr("id",function(d){return toplineOrder_grad[j]}).attr("cx",function(d,i){return circleSpace*Math.floor(i/circlesPerCol)}).attr("cy",function(d,i){return 2*h_bigLabels+4*(circlesPerCol*circleSpace+10)+margin_btwn+(circlesPerCol*circleSpace+10)*j+circleSpace*(i%circlesPerCol)}).attr("r",circleRadius);for(svg.select("#labelGroup").selectAll("labels").data(["Law school","Masters","Medical school","Doctorate"]).enter().append("text").attr("class","smallLabels").attr("id","gradSmallLabels").text(function(d){return d}).attr("x",0).attr("y",function(d,i){return 2*h_bigLabels+4*(circlesPerCol*circleSpace+10)+margin_btwn+circleSpace*(circlesPerCol/3)+(10+circleSpace*circlesPerCol)*i}).call(wrap,w_labels-20),j=0;j<15;j++)svg.select("#col1").selectAll("workDots").data(dataset_ind.filter(function(d){return 1==d[toplineOrder_career[j]]})).enter().append("circle").attr("class","memberDots").attr("id",function(d){return toplineOrder_career[j]}).attr("cx",function(d,i){return circleSpace*Math.floor(i/circlesPerCol)}).attr("cy",function(d,i){return 3*h_bigLabels+8*(circlesPerCol*circleSpace+10)+2*margin_btwn+(circlesPerCol*circleSpace+10)*j+circleSpace*(i%circlesPerCol)}).attr("r",circleRadius);for(svg.select("#labelGroup").selectAll("labels").data(["Business/ management","Private law","Military","Education","Nonprofits & unions","Medicine","Real estate","Farming/ ranching","Media","Lobbying/ activism","Blue-collar/ service job","Science/ engineering","Law enforcement","Sports","Religious leader"]).enter().append("text").attr("class","smallLabels").attr("id","careerSmallLabels").text(function(d){return d}).attr("x",0).attr("y",function(d,i){return 3*h_bigLabels+8*(circlesPerCol*circleSpace+10)+2*margin_btwn+circleSpace*(circlesPerCol/3)+(10+circleSpace*circlesPerCol)*i}).call(wrap,w_labels-20),j=0;j<5;j++)svg.select("#col1").selectAll("govDots").data(dataset_ind.filter(function(d){return 1==d[toplineOrder_gov[j]]})).enter().append("circle").attr("class","memberDots").attr("id",function(d){return toplineOrder_gov[j]}).attr("cx",function(d,i){return circleSpace*Math.floor(i/circlesPerCol)}).attr("cy",function(d,i){return 4*h_bigLabels+23*(circlesPerCol*circleSpace+10)+3*margin_btwn+(circlesPerCol*circleSpace+10)*j+circleSpace*(i%circlesPerCol)}).attr("r",circleRadius);svg.select("#labelGroup").selectAll("labels").data(["State legislature","Local government","No previous office","Federal or state office","Public lawyer or judge"]).enter().append("text").attr("class","smallLabels").attr("id","govSmallLabels").text(function(d){return d}).attr("x",0).attr("y",function(d,i){return 4*h_bigLabels+23*(circlesPerCol*circleSpace+10)+3*margin_btwn+circleSpace*(circlesPerCol/3)+(10+circleSpace*circlesPerCol)*i}).call(wrap,w_labels-20),svg.selectAll(".memberDots").on("mouseover",function(){var currDot,currX,currY;currDot=d3.select(this),currX=parseInt(currDot.attr("cx")),currY=parseInt(currDot.attr("cy")),currDot.style("fill",repColor),svg.append("rect").attr("class","mouseover_back").attr("x",currX+10).attr("y",currY).attr("width",100).attr("height",20).style("fill","white"),svg.append("text").attr("class","mouseover_text").text(function(){return currDot.data()[0].full_name+" ("+currDot.data()[0].state+")"}).attr("x",currX+15).attr("y",currY+10).call(wrap,95)}).on("mouseout",function(){d3.select(this).style("fill",function(d){return 1==d[currValue]?experienceColor:d.state==currValue?stateColor:d.full_name==currRep?repColor:green}),svg.selectAll(".mouseover_text").remove(),svg.selectAll(".mouseover_back").remove()}),svg.selectAll(".smallLabels").on("click",function(){svg.selectAll(".smallLabels").style("fill","black").style("font-weight",400),svg.selectAll(".memberDots").style("fill",green);var smallLabel,selection=d3.select(this);selection.text(),selection.style("font-weight",500).style("fill",experienceColor),smallLabel=selection.data()[0],currValue=function(smallLabel){return["college_public","college_private","college_elite","college_none","edu_law","edu_masters","edu_med","edu_doctorate","work_business","work_privatelaw","work_military","work_education","work_nonprofits","work_medicine","work_realestate","work_farming","work_media","work_lobbying","work_bluecollar","work_science","work_lawenforcement","work_sports","work_religiousleader","gov_stateleg","gov_local","gov_none","gov_fedstate","gov_publiclawyerjudge"][["Public school","Private school","Elite school","No Bachelor's degree","Law school","Masters","Medical school","Doctorate","Business/ management","Private law","Military","Education","Nonprofits & unions","Medicine","Real estate","Farming/ ranching","Media","Lobbying/ activism","Blue-collar/ service job","Science/ engineering","Law enforcement","Sports","Religious leader","State legislature","Local government","No previous office","Federal or state office","Public lawyer or judge"].indexOf(smallLabel)]}(smallLabel),currExp=!(currRep=!1),updateDots(d3.select("#col1"),dataset_ind.sort(function(a,b){return b[currValue]-a[currValue]})),colorDots()})}(),window.addEventListener("resize",function(){w=document.getElementById("chart-svg").getBoundingClientRect().width,circlesPerRowMax=Math.floor((w-w_labels-20)/circleSpace),circlesPerCol=Math.ceil(219/circlesPerRowMax),circlesPerRow=Math.ceil(219/circlesPerCol),margin_left=margin_right=(w-w_labels-circlesPerRow*circleSpace)/2,h=margin_top+4*h_bigLabels+28*(circlesPerCol*circleSpace+10)+3*margin_btwn+margin_bottom,document.getElementById("chart-svg").style.height=h,resize()})}function rowConverter1(d){return{full_name:d.full_name,state:d.state,edu_med:parseInt(parseInt(d.edu_med)),edu_law:parseInt(d.edu_law),edu_masters:parseInt(d.edu_masters),edu_doctorate:parseInt(d.edu_doctorate),work_bluecollar:parseInt(d.work_bluecollar),work_business:parseInt(d.work_business),work_education:parseInt(d.work_education),work_farming:parseInt(d.work_farming),work_lawenforcement:parseInt(d.work_lawenforcement),work_lobbying:parseInt(d.work_lobbying),work_media:parseInt(d.work_media),work_medicine:parseInt(d.work_medicine),work_military:parseInt(d.work_military),work_nonprofits:parseInt(d.work_nonprofits),work_privatelaw:parseInt(d.work_privatelaw),work_realestate:parseInt(d.work_realestate),work_religiousleader:parseInt(d.work_religiousleader),work_science:parseInt(d.work_science),work_sports:parseInt(d.work_sports),gov_fedstate:parseInt(d.gov_fedstate),gov_local:parseInt(d.gov_local),gov_none:parseInt(d.gov_none),gov_publiclawyerjudge:parseInt(d.gov_publiclawyerjudge),gov_stateleg:parseInt(d.gov_stateleg),new:parseInt(d.new),gender:d.gender,party:d.party,college_none:parseInt(d.college_none),college_public:parseInt(d.college_public),college_private:parseInt(d.college_private),college_elite:parseInt(d.college_elite)}}function rowConverter2(d){return{experience:d.experience,count:parseInt(d.count)}}d3.csv("Data/merged.csv",rowConverter1,function(data1){d3.csv("Data/counts.csv",rowConverter2,function(data2){dataset_ind=data1,dataset_counts=data2,init()})});